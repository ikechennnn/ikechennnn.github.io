
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
    <title>Hurricanes</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>

    
    <div id="container">
      <div id="banner">

        <h1>Atlantic Hurricane & Tropical Storm Activity</h1>

        <h2>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ut enim sit amet turpis elementum tristique at in mauris.
        </h2>
        <h3>
          Created by Muxing Chen
        </h3>
      </div>
      <div id="introduction">
        <p>This is a tracker of hurricanes</p>
      </div>

      <div class="section" id="wrapper">
        <svg id="chart1">
          <g id="map"></g>
        </svg>
        <div id="brush"></div>
        <div id="tooltip"></div>

      </div>

      <div id="narrative">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ut enim sit amet turpis elementum tristique at in mauris. Etiam egestas nulla vel leo dictum eleifend. Aenean ac gravida leo. Phasellus sed justo rutrum, iaculis orci vel, fringilla nisi. Pellentesque vestibulum aliquam odio, sed suscipit metus aliquet rutrum. Nam pharetra et nibh a semper. Phasellus a eleifend magna. Nulla vel sapien vulputate, finibus justo ac, convallis odio. Nulla et augue arcu. Duis porta augue laoreet lacus dictum, eu hendrerit sem tempor. Integer condimentum, enim sit amet sollicitudin pretium, ligula leo convallis nibh, eget aliquam ex orci vitae quam. Morbi maximus.</p>
      </div>

    </div>  

   

    <!-- <div id="tooltip">
      <h2 id="title"></h2>
      Value: <span id="value"></span>
    </div> -->

    <script src="banner.js"></script>
    <!-- <script src="chart1.js"></script> -->
    <script src="chart2.js"></script>
   
    <script>

      
      
      var width = 1350;
      var height = 500;
      var chart1Width = document.getElementById("chart1").getBoundingClientRect().width;
      var chart1Height = document.getElementById("chart1").getBoundingClientRect().height;

      var svg = d3.select("#chart1")
          .attr("width", chart1Width)
          .attr("height", chart1Height);
      
      

      // Geojson Data Dail in
      d3.json("world-alpha3.json", function(error, world) {
            console.log(world);
            var geoJSON = topojson.feature(world, world.objects.countries);
            console.log(geoJSON);
      
      var map = svg.select("#map");
      // d3.json("northamerica.json", function(error, world) {
      //       console.log(world);
      //       var geoJSON = topojson.feature(world, world.objects.continent_North_America_subunits)
      //       console.log(geoJSON)

      // choose projection
      var projection = d3.geoMercator()
            .fitSize([chart1Width, chart1Height], geoJSON)
            .translate([1700,1100])
            .scale(900);
      
      // create path
      var path = d3.geoPath()
            .projection(projection);
      
      // filter the data
      // geoJSON.features = geoJSON.features.filter(function(d) {
      //     return d.id !== "ATA";
      // });

      var mapgroup = map.selectAll("path")
          .data(geoJSON.features);
      // enter the map
      mapgroup.enter().append("path")
          // d attribute in <path>
          .attr("d", path)
          .attr("fill", "#252525")
          .attr("vector-effect","non-scaling-stroke")
          .attr("stroke", "#999")
          .attr("stroke-width", "0.4px");
      
      d3.csv("data/clean4.csv", function(error, dotdata){
          console.log(dotdata.filter(function(d){return d.Year == "1851"}));
          // data type conversion
          dotdata.forEach(function(d){
            d.Latitude = +d.Latitude;
            d.Longtitude = +d.Longtitude;
            // Year = d3.timeFormat("%Y");
            d.Year = +d.Year
          });
          console.log(dotdata);


          // dots
          
          var dots = map.selectAll("circle")
            .data(dotdata);

          var tooltip = d3.select("#tooltip")
                    
                    .attr("position", "absolute")
                    .style("opacity", 0)
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("border-width", "2px")
                    .style("border-radius", "5px")
                    .style("padding", "5px")
      
          dots.enter().append("circle")
          .attr("transform", function(d){
              return "translate(" + projection([+d.Longtitude,+d.Latitude]) + ")";
          })
          .attr("fill","#5d5e99")
          .attr("r", 6)
          .on("mouseover", mouseover)
          .on("mousemove", mousemove)
          .on("mouseout", mouseout);

          
          

          function mousemove(d) {
            d3.select(this)
              .attr("fill","#c20b1e")
              .attr("r",12)
              .attr("stroke-width", "1px")
              .attr("fill-opacity", "1");
            tooltip.style("opacity", 1)
                 .style("display", "block")
                //  .style("top", (d3.mouse(this)[1]) + "px")
                //  .style("left", (d3.mouse(this)[0]+70) + "px")
                 .style("top", d3.event.pageY + 20 + "px")
                 .style("left", d3.event.pageX + 20 + "px")
                 .html(
                  "Year: <b>" +
                    d.Year+
                    "</b></br>Name: <b>" +
                     d.STORMNAME+
                    "</b></br>Storm Level: <b>" +
                     d.STORMLEVEL+
                    "</b></br>Maximum Wind Speed(mph): <b>" +
                     d.Maximummph +
                    "</b> <br>" 
                 );

                 
          }

          function mouseover(d) {
            d3.select(this)
              .attr("fill","#c20b1e")
              .attr("r",12)
              .attr("stroke-width", "1px")
              .attr("fill-opacity", "1");
            tooltip.style("opacity", 0.9)
                 
          }

          function mouseout(d) {
            d3.select(this)
              .attr("fill", "#5d5e99")
              .attr("r",6)
              .attr("stroke-width", ".3")
              .attr("fill-opacity", "1");
            tooltip.style("opacity", 0);
          }

          
          // brush
          
          
          var brushWidth = chart1Width;
          var brushHeight = 150;
          var yeardomainMax = d3.max(dotdata, d => d.Year);
          console.log(yeardomainMax);
          var yeardomainMin = d3.min(dotdata, d => d.Year);
          console.log(yeardomainMin);
          
          var brushsvg = d3.select("#brush").append("svg")
                           .attr("width", brushWidth)
                           .attr("height", brushHeight+50)
                           .attr("transform", "translate(0," + 20 + ")")
                           .append("g")
                          //  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


          var brushscale = d3.scaleLinear()
              .domain([yeardomainMin, yeardomainMax])
              .range([0, brushWidth]);
          
          
          
          brushsvg.append("g")
              .attr("class", "axis axis--grid")
              .attr("transform", "translate(0," + brushHeight + ")")
              .call(d3.axisBottom(brushscale)
                  .ticks(20)
                  .tickSize(-brushHeight)
                  // .tickValues([1851,2015])
                  .tickFormat(function() { return null; }))
              .selectAll(".tick")
              // .classed("tick--minor", function(d) { return d.getHours(); });
          
          brushsvg.append("g")
              .attr("class", "axis axis--x")
              .attr("transform", "translate(0," + brushHeight + ")")
              .call(d3.axisBottom(brushscale)
                  .ticks(9)
                  .tickFormat(d3.format("d"))
                  .tickSize(5)
                  .tickPadding(0))
              .attr("text-anchor", null)
              .style("font","20")
              .selectAll("text")
              .attr("x", 5);
          
          brushsvg.append("g")
              .attr("class", "brush")
              .call(d3.brushX()
                  .extent([[0, 0], [brushWidth, brushHeight]])
                  .on("brush", brushed));
          
          function brushed() {
            if (!d3.event.sourceEvent) return; // Only transition after input.
            if (!d3.event.selection) return; // Ignore empty selections.
            var selection = d3.event.selection.map(brushscale.invert);
            console.log(parseInt(selection[0]));
            console.log(parseInt(selection[1]));
            var dataFiltered = dotdata.filter(function(d) {return d.Year <= parseInt(selection[1]) && d.Year >= parseInt(selection[0]) ;});
            console.log(dataFiltered);
            dotsupdate(dataFiltered);
          }  
          
          function dotsupdate(filter) {
            var dots = map.selectAll("circle")
                        .data(filter);

                
            dots.enter().append("circle")
                // .transition()
                .attr("transform", function(d){
                  return "translate(" + projection([+d.Longtitude,+d.Latitude]) + ")";
                })
                .attr("fill","#5d5e99")
                .attr("r", 6);
                
            dots.exit()
              // .transition()
              .remove();
                   
                   
            dots.on("mouseover", mouseover);
            dots.on("mousemove", mousemove);
            dots.on("mouseout", mouseout);

          }

          // Area Chart

          d3.csv("data/Count_By_Year.csv", function(error, areadata){
            console.log(areadata);
            areadata.forEach(function(d){
            d.Year = +d.Year;
            d.Minor = +d.Minor;
            d.Major = +d.Major;
          });
            console.log(areadata);

            // var areasvg = d3.select("#Brush").append("svg")
            //                .attr("width", brushWidth)
            //                .attr("height", brushHeight)
            //                .attr("transform", "translate(0," + 8 + ")")
            //                .append("g")
            
            var areaScaleX = d3.scaleLinear()
                           .domain([d3.min(areadata, function(d){return d.Year;}),
                            d3.max(areadata, function(d){return d.Year;})])
                           .range([0, brushWidth]);
            // console.log(areaScaleX(1990));

            
            
            var stack = d3.stack()
                          .keys(["Minor", "Major"]);
            
            var stackColor = ["#b3b3b3","#5d5e99"];

            var stackedData = stack(areadata);
            console.log(stackedData);

            var areaScaleY = d3.scaleLinear()
                           .domain([0, d3.max(stackedData[stackedData.length-1], function(d){return d[1]})])
                           .range([brushHeight, 0]);
            
            brushsvg.append("g")
                   .call(d3.axisRight(areaScaleY)
                   .ticks(4)
                      .tickFormat(d3.format("d"))
                      .tickSize(5)
                      .tickPadding(0))
                   .attr("text-anchor", null)
                   .style("font","20")
                   .selectAll("text")
                   .attr("x", 5);
            
            brushsvg.append("text")
                .attr("text-anchor", "end")
                .attr("x", 35)
                .attr("y", 15 )
                .text("# of Hurricane Activity")
                .attr("text-anchor", "start");

            var area = d3.area()
                         .curve(d3.curveCardinal)
                         .x(function(d){return areaScaleX(d.data.Year);})
                         .y0(function(d){return areaScaleY(d[0]);})
                         .y1(function(d){return areaScaleY(d[1]);})
            
            var series = brushsvg.selectAll("g.series")
                                 .data(stackedData)
                                 .enter()
                                 .append("g")
                                 .attr("class", "series");
            series.append("path")
                  .style("fill", function(d,i){return stackColor[i];})
                  .attr("d", function(d){return area(d);});

            
            

            // line chart

            var linechart = brushsvg.selectAll("g.line")
                               .data(areadata)
                               .enter()
                               .append("g")
                               .attr("class", "line")
                               
            linechart.append("path")
                .attr("fill", "none")
                .attr("stroke", "black")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                  .x(function(d) { return x(d.Year) })
                  .y(function(d) { return y(d.Ocean) })
                  )

            
          });

      
       

                
      });
      
      // Zoom feature
      var zoom = d3.zoom()
            .translateExtent([[0, 0], [chart1Width, chart1Height]])
            .scaleExtent([1, 4])
            .on("zoom", zoomed);
        
      function zoomed() {
          map.attr("transform", d3.event.transform);
      }
      svg.call(zoom);
      
      
      

      
      });

      

      

    </script>
    
    
  </body>>  
</html>